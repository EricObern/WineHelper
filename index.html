<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Restaurant Wine Study Tool</title>
    <style>
        :root {
            --primary-color: #4a148c; /* Deep Purple */
            --secondary-color: #f3e5f5; /* Light Lavender */
            --accent-color: #7b1fa2; /* Medium Purple */
            --text-color: #333;
            --light-text: #fdfdfd;
            --border-color: #ddd;
            --shadow-color: rgba(0,0,0,0.1);
            --success-color: #2e7d32;
            --error-color: #c62828;
            --gold-color: #fbc02d;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f9f9f9;
            color: var(--text-color);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            background: linear-gradient(135deg, var(--primary-color), var(--accent-color));
            color: var(--light-text);
            padding: 25px 20px;
            text-align: center;
            border-bottom-left-radius: 20px;
            border-bottom-right-radius: 20px;
            box-shadow: 0 4px 12px var(--shadow-color);
        }

        header h1 {
            margin: 0;
            font-size: 2.5em;
            font-weight: 700;
        }

        .main-nav {
            display: flex;
            justify-content: center;
            margin: 25px 0;
            background-color: #fff;
            border-radius: 12px;
            box-shadow: 0 2px 6px var(--shadow-color);
            padding: 10px;
            gap: 10px;
        }

        .main-nav-btn {
            padding: 15px 30px;
            border: none;
            background-color: transparent;
            color: var(--primary-color);
            font-size: 1.2em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            border-radius: 8px;
            flex-grow: 1;
            text-align: center;
        }

        .main-nav-btn.active {
            background-color: var(--primary-color);
            color: var(--light-text);
            box-shadow: 0 2px 8px rgba(74, 20, 140, 0.5);
        }

        .content-section {
            display: none;
            animation: fadeIn 0.5s ease-in-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .content-section.active {
            display: block;
        }
        
        .tool-container {
            padding: 25px;
            background-color: #fff;
            border-radius: 12px;
            box-shadow: 0 2px 6px var(--shadow-color);
        }

        .sub-nav {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 25px;
            border-bottom: 2px solid var(--border-color);
            padding-bottom: 20px;
        }

        .sub-nav-btn {
            padding: 10px 20px;
            border: 1px solid var(--accent-color);
            background-color: #fff;
            color: var(--accent-color);
            border-radius: 50px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
        }
        
        .sub-nav-btn:hover {
            background-color: var(--secondary-color);
            transform: translateY(-2px);
        }

        .sub-nav-btn.active {
            background-color: var(--accent-color);
            color: var(--light-text);
            border-color: var(--accent-color);
        }
        
        .tool-content {
            display: none;
        }

        .tool-content.active {
            display: block;
            animation: fadeIn 0.4s;
        }

        /* Flashcards */
        #flashcard-container {
            perspective: 1500px;
            width: 100%;
            height: 400px;
            margin: 20px auto;
        }

        .flashcard {
            width: 100%;
            height: 100%;
            position: relative;
            transform-style: preserve-3d;
            transition: transform 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            cursor: pointer;
            box-shadow: 0 5px 20px var(--shadow-color);
            border-radius: 15px;
        }

        .flashcard.is-flipped {
            transform: rotateY(180deg);
        }

        .card-face {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 25px;
            box-sizing: border-box;
            border-radius: 15px;
            background-color: #fff;
            border: 1px solid var(--border-color);
            overflow: hidden;
        }

        .flashcard-front h2 {
            font-size: 2.4em;
            color: var(--primary-color);
            text-align: center;
        }

        .flashcard-back {
            transform: rotateY(180deg);
            align-items: flex-start;
            overflow-y: auto;
        }
        
        .flashcard-back h3 {
            color: var(--accent-color);
            border-bottom: 2px solid var(--secondary-color);
            padding-bottom: 5px;
            margin: 10px 0;
            width: 100%;
        }
        
        .flashcard-back p { margin: 5px 0; width: 100%; }
        .flashcard-back ul { padding-left: 20px; margin: 5px 0; width: 100%; }
        
        .flashcard-nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 20px;
        }
        
        .flashcard-nav button {
            padding: 12px 24px;
            font-size: 1em;
            font-weight: bold;
            cursor: pointer;
            background-color: var(--accent-color);
            color: var(--light-text);
            border: none;
            border-radius: 8px;
            transition: background-color 0.3s;
        }
        .flashcard-nav button:hover { background-color: var(--primary-color); }
        
        /* Quiz */
        .quiz-question { margin-bottom: 25px; }
        .quiz-question p { font-weight: bold; font-size: 1.2em; margin-bottom: 15px; }
        .quiz-options label {
            display: block;
            margin: 10px 0;
            padding: 15px;
            background: var(--secondary-color);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease-in-out;
            border-left: 5px solid transparent;
        }
        .quiz-options label:hover { background: #e1bee7; border-left: 5px solid var(--accent-color); }
        .quiz-options input:checked + span { font-weight: bold; }
        
        #submit-quiz-btn {
            margin-top: 20px;
            padding: 15px 30px;
            font-size: 1.2em;
            background-color: var(--success-color);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        #submit-quiz-btn:hover { background-color: #1b5e20; }
        #quiz-results { margin-top: 25px; font-size: 1.3em; font-weight: bold; text-align: center; }
        .result-feedback { padding: 15px; margin-top: 10px; border-radius: 8px; font-weight: 500;}

        /* Visuals */
        .chart-container { margin-bottom: 50px; }
        .chart-title { text-align: center; font-size: 1.8em; color: var(--primary-color); margin-bottom: 25px; }
        .bar-chart { display: grid; gap: 15px; }
        .bar-chart-item { display: grid; grid-template-columns: 200px 1fr; align-items: center; gap: 10px; }
        .bar-label { text-align: right; font-weight: 500; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .bar-wrapper { background-color: var(--secondary-color); border-radius: 5px; }
        .bar {
            height: 30px;
            background: linear-gradient(90deg, var(--accent-color), var(--primary-color));
            border-radius: 5px;
            color: white;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding-right: 10px;
            box-sizing: border-box;
            box-shadow: 2px 2px 5px var(--shadow-color);
            white-space: nowrap;
            transition: width 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }

        /* Serving Tools */
        .filter-group { margin-bottom: 25px; }
        .filter-group h3 { color: var(--accent-color); border-bottom: 1px solid var(--border-color); padding-bottom: 8px; }
        .filter-tags { display: flex; flex-wrap: wrap; gap: 10px; }
        .filter-tags label {
            display: inline-block;
            margin: 5px;
            padding: 8px 15px;
            background-color: var(--secondary-color);
            border-radius: 50px;
            cursor: pointer;
            user-select: none;
            transition: all 0.3s ease;
        }
        .filter-tags input { display: none; }
        .filter-tags input:checked + label {
            background-color: var(--primary-color);
            color: var(--light-text);
            box-shadow: 0 2px 5px rgba(74, 20, 140, 0.4);
        }

        .results-grid, .food-pairing-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .wine-card, .food-card {
            background: #fff;
            border: 1px solid var(--border-color);
            border-left: 5px solid var(--accent-color);
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 5px var(--shadow-color);
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        .wine-card:hover { transform: translateY(-5px); box-shadow: 0 4px 10px var(--shadow-color); }
        .wine-card h4, .food-card h3 { margin-top: 0; color: var(--primary-color); }
        .food-card { cursor: pointer; border-left-color: var(--success-color); transition: all 0.2s ease; }
        .food-card h3 { color: var(--success-color); }
        .food-card:hover, .food-card.selected { background-color: var(--secondary-color); transform: translateY(-5px); box-shadow: 0 4px 10px var(--shadow-color); }
        #pairing-results { margin-top: 25px; }
        #pairing-results h3 { color: var(--primary-color); }
        .note { color: var(--gold-color); font-weight: bold; margin-top: 10px; }

        @media (max-width: 768px) {
            .main-nav { flex-direction: column; }
            .bar-chart-item { grid-template-columns: 1fr; gap: 5px; }
            .bar-label { text-align: left; }
            .results-grid, .food-pairing-grid { grid-template-columns: 1fr; }
            header h1 { font-size: 2em; }
        }
    </style>
</head>
<body>

    <header>
        <h1>Wine Study & Service Tool</h1>
    </header>

    <div class="container">
        <nav class="main-nav">
            <button class="main-nav-btn active" data-target="study-section">Study Mode</button>
            <button class="main-nav-btn" data-target="service-section">Service Mode</button>
        </nav>

        <main>
            <!-- ======================= -->
            <!-- ===== STUDY SECTION ===== -->
            <!-- ======================= -->
            <section id="study-section" class="content-section active">
                <div class="tool-container">
                    <nav class="sub-nav" id="study-sub-nav">
                        <button class="sub-nav-btn active" data-target="flashcards-tool">Flashcards</button>
                        <button class="sub-nav-btn" data-target="quiz-tool">Quiz</button>
                        <button class="sub-nav-btn" data-target="visuals-tool">Visual Aids</button>
                    </nav>

                    <div id="flashcards-tool" class="tool-content active">
                        <h2>Flashcards</h2>
                        <p>Click the card to flip it. Use the buttons to navigate.</p>
                        <div id="flashcard-container">
                            <div class="flashcard" id="flashcard">
                                <div class="card-face flashcard-front"><h2 id="flashcard-front-content"></h2></div>
                                <div class="card-face flashcard-back" id="flashcard-back-content"></div>
                            </div>
                        </div>
                        <div class="flashcard-nav">
                            <button id="prev-card">Previous</button>
                            <span id="card-counter"></span>
                            <button id="next-card">Next</button>
                        </div>
                    </div>

                    <div id="quiz-tool" class="tool-content">
                        <h2>Knowledge Quiz</h2>
                        <p>Test your expertise. A new quiz is generated each time you click the "Quiz" tab.</p>
                        <div id="quiz-container"></div>
                        <button id="submit-quiz-btn">Submit Answers</button>
                        <div id="quiz-results"></div>
                    </div>

                    <div id="visuals-tool" class="tool-content">
                        <h2>Visual Aids</h2>
                        <p>Quickly compare wines based on their primary characteristics.</p>
                        <div class="chart-container">
                            <h3 class="chart-title">White & Rosé Wine Body Spectrum</h3>
                            <div class="bar-chart" id="white-body-chart"></div>
                        </div>
                        <div class="chart-container">
                            <h3 class="chart-title">Red Wine Tannin Spectrum</h3>
                            <div class="bar-chart" id="red-tannin-chart"></div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- ========================= -->
            <!-- ===== SERVICE SECTION ===== -->
            <!-- ========================= -->
            <section id="service-section" class="content-section">
                 <div class="tool-container">
                    <nav class="sub-nav" id="service-sub-nav">
                        <button class="sub-nav-btn active" data-target="recommender-tool">Wine Recommender</button>
                        <button class="sub-nav-btn" data-target="pairing-tool">Food Pairing Guide</button>
                    </nav>

                    <div id="recommender-tool" class="tool-content active">
                        <h2>Wine Recommender</h2>
                        <p>Select tags based on what your guest is looking for to get instant recommendations.</p>
                        <div id="filter-container"></div>
                        <h3>Results:</h3>
                        <div id="filter-results" class="results-grid">
                            <p>Select one or more tags above to see matching wines.</p>
                        </div>
                    </div>

                    <div id="pairing-tool" class="tool-content">
                        <h2>Food Pairing Guide</h2>
                        <p>Select a menu item to see the best wine pairings instantly.</p>
                        <div id="food-menu-container" class="food-pairing-grid"></div>
                        <div id="pairing-results"></div>
                    </div>
                </div>
            </section>
        </main>
    </div>

<script>
// ===================================================================================
// ===== WINE & FOOD DATA (Source of Truth) =====
// ===================================================================================
const wineData = [
    { name: "Giavi DOCG Rosé Prosecco", type: "Sparkling", availability: "Bottle only", region: "Veneto, Italy", grapes: "Glera with Pinot Noir", taste: "Light-bodied, crisp, fine bubbles, dry to off-dry, red berries, citrus freshness.", aroma: "Wild strawberries, raspberries, rose petals, citrus zest, green apple.", pairings: ["Wine Country Sangria Salad", "Heirloom Tomato Burrata", "Watermelon Seasonal Fruit bowl", "Vanilla Yogurt and Granola Bowl"], tags: ["Light", "Crisp", "Bubbly", "Fruity", "Refreshing"]},
    { name: "Bisol Jeio Brut Prosecco", type: "Sparkling", availability: "By glass or by bottle", region: "Valdobbiadene, Veneto, Italy", grapes: "Glera", taste: "Crisp, clean, vibrant acidity, dry, smooth, pear, apple, citrus.", aroma: "Green apple, white peach, acacia flowers, pear skin, lemon peel.", pairings: ["Modern Ceasar", "Watermelon Seasonal Fruit Bowl", "Wine Country Sangria Salad", "Green Goddess"], tags: ["Light", "Crisp", "Bubbly", "Dry", "Refreshing"]},
    { name: "Allimant-Laugner Crémant d'Alsace Brut", type: "Sparkling", availability: "By glass or by bottle", region: "Alsace, France", grapes: "Pinot Blanc, Pinot Auxerrois, Riesling, etc.", taste: "Elegant, refined, creamy mousse, bright acidity, green apple, pear, brioche.", aroma: "White blossoms, apple blossom, citrus rind, toasty, bread, honey.", pairings: ["Smoked salmon plate", "French Style Omelet", "Modern Ceasar", "Mahi and Meyer Lemon Sandwich"], tags: ["Elegant", "Creamy", "Bubbly", "Toasty", "Dry"]},
    { name: "Taittinger Brut La Française Champagne", type: "Sparkling", availability: "By glass and by Bottle", region: "Champagne, France", grapes: "Chardonnay, Pinot Noir, Pinot Meunier", taste: "Medium-bodied, balanced, persistent bubbles, dry, apple, peach, brioche, creamy.", aroma: "Toasted brioche, hazelnut, citrus peel, green apple, honeysuckle.", pairings: ["Crab Cake Benny", "Ham and Cheese Croissant", "French Style Omelet", "Heirloom Tomato Burrata"], tags: ["Classic", "Creamy", "Bubbly", "Toasty", "Elegant", "Rich"]},
    { name: "Sea Cove Sauvignon Blanc", type: "White", availability: "By glass or bottle", region: "Marlborough, New Zealand", grapes: "Sauvignon Blanc", taste: "Light-bodied, zesty, high acidity, dry, strong citrus and tropical fruit.", aroma: "Passionfruit, lime, grapefruit, fresh-cut grass, bell pepper.", pairings: ["Smoked Salmon Plate", "Chickpea and Salmon Plate", "Wine Country Sangria Salad", "Mahi and Meyer Lemon Sandwich"], tags: ["Light", "Crisp", "Zesty", "Grassy", "Refreshing"], body: "Light"},
    { name: "Hourglass Sauvignon Blanc", type: "White", availability: "By glass or bottle", region: "Napa Valley, California", grapes: "91% Sauvignon Blanc, 9% Semillon", taste: "Medium-bodied, richer texture, rounded finish, citrus, melon, stone fruit.", aroma: "White peach, lemongrass, citrus zest, subtle oak spice.", pairings: ["Mahi and Meyer Lemon Sandwich", "Green Goddess", "Wine Country Sangria Salad", "Heirloom Tomato Burrata"], tags: ["Medium-Bodied", "Rich", "Fruity", "Elegant"], body: "Medium"},
    { name: "Daniel Reverdy Sancerre", type: "White", availability: "By glass or bottle", region: "Loire Valley, France", grapes: "Sauvignon Blanc", taste: "Light to medium-bodied, crisp, bone-dry, elegant minerality.", aroma: "Lime, green apple, flint, wet stone, grass, white flowers.", pairings: ["Modern Ceasar Salad", "French Style Omelet", "Wine Country Sangria Salad", "Heirloom Tomato Burrata"], tags: ["Light", "Crisp", "Dry", "Mineral", "Elegant", "Grassy"], body: "Light"},
    { name: "La Marea Albariño", type: "White", availability: "By glass or bottle", region: "Monterey, California", grapes: "Albariño", taste: "Crisp, saline, medium acidity, dry, light to medium-bodied, citrus and stone fruit.", aroma: "Lemon zest, apricot, sea spray, white flowers, peach, mandarin.", pairings: ["Shakshuka", "Coastal Chickpea and Salmon", "Smoked Salmon Plate", "Mahi and Meyer Lemon Sandwich", "Modern Ceasar Salad"], tags: ["Crisp", "Mineral", "Fruity", "Refreshing", "Coastal"], body: "Light"},
    { name: "Hill Family White Barrel Blend", type: "White", availability: "By glass or bottle", region: "Napa Valley, California", grapes: "Chardonnay and Sauvignon Blanc", taste: "Medium to full-bodied, oak influence, richness, creaminess, ripe fruit, and vanilla.", aroma: "Baked apple, vanilla, honeydew melon, spice, toasty oak.", pairings: ["Crab Cake Benny", "French Style Omelet", "Smoked Salmon Plate", "Coastal Chickpea and Salmon"], tags: ["Rich", "Creamy", "Full-Bodied", "Oaked"], body: "Full"},
    { name: "Elena Walch Pinot Grigio", type: "White", availability: "By glass and bottle", region: "Alto Adige, Italy", grapes: "Pinot Grigio", taste: "Light-bodied, crisp, dry, lively acidity with clean citrus and orchard fruit.", aroma: "Green apple, lemon, pear, almond blossom, slightly mineral.", pairings: ["Mahi and Meyer Lemon Sandwich", "Green Goddess", "Orchard Chicken Salad Croissant", "Heirloom Tomato Burrata"], tags: ["Light", "Crisp", "Dry", "Refreshing", "Mineral"], body: "Light"},
    { name: "Eric Variet Bourgogne Aligoté", type: "White", availability: "By glass or bottle", region: "Burgundy, France", grapes: "Aligoté", taste: "Light-bodied, high acidity, bone-dry, lean with subtle fruit.", aroma: "Lemon, green apple, white flowers, chalky minerality, flinty.", pairings: ["Smoked Salmon Plate", "Coastal Chickpea", "Green Goddess", "Modern Ceasar"], tags: ["Light", "Crisp", "Dry", "Mineral", "Zesty"], body: "Light"},
    { name: "RouteStock Route 121 Chardonnay", type: "White", availability: "By glass or bottle", region: "Carneros, California", grapes: "Chardonnay blend (Wente, Dijon, Musque)", taste: "Medium to full-bodied, balanced oak and acidity, creamy texture, ripe fruit, toasty notes.", aroma: "Baked apple, lemon curd, toasted brioche, vanilla, nutmeg, light butter.", pairings: ["Mahi and Meyer Lemon Sandwich", "Heirloom Tomato Burrata", "Smoked Salmon Plate", "Modern Ceasar Salad"], tags: ["Rich", "Creamy", "Oaked", "Full-Bodied", "Toasty"], body: "Full"},
    { name: "ZD Chardonnay", type: "White", availability: "By glass or bottle", region: "Napa Valley, California", grapes: "Chardonnay", taste: "Full-bodied, luxurious, rich texture, moderate oak, lush tropical, stone, and citrus fruit.", aroma: "Pineapple, mango, pear, vanilla bean, toasty oak, creamy finish.", pairings: ["Crab Cake Benny", "Smoked Salmon Plate", "Heirloom Tomato Burrata", "Orchard Chicken Salad Croissant"], tags: ["Rich", "Creamy", "Full-Bodied", "Oaked", "Fruity"], body: "Full"},
    { name: "Paul Lato Chardonnay", type: "White", availability: "By bottle only", region: "Santa Barbara, California", grapes: "Chardonnay", taste: "Full-bodied, elegant, nuanced, balanced acidity, vibrant fruit, integrated oak.", aroma: "Lemon curd, nectarine, white flower, crème brûlée, toasted almond, wet stone.", pairings: ["Mahi and Meyer Lemon Sandwich", "Smoked Salmon Plate", "Crab Cake Benny", "Orchard Chicken Salad Croissant"], tags: ["Rich", "Creamy", "Full-Bodied", "Oaked", "Elegant", "Mineral"], body: "Full"},
    { name: "Domaine Fèvre Premier Cru White Burgundy", type: "White", availability: "By bottle only", region: "Chablis, Burgundy, France", grapes: "Chardonnay", taste: "Medium-bodied, bone-dry, razor-sharp acidity, intense minerality.", aroma: "Lemon, oyster shell, flint, white flowers, subtle chalk and saline edge.", pairings: ["Chicken and Artichoke Soup", "Modern Ceasar with Salmon", "French Style Omelet", "Crab Cake Benny"], tags: ["Crisp", "Dry", "Mineral", "Elegant", "Zesty", "Classic"], body: "Medium"},
    { name: "Lucy by Pisoni Rosé", type: "Rosé", availability: "By glass or bottle", region: "Santa Lucia Highlands, California", grapes: "100% Pinot Noir", taste: "Dry, crisp, refreshing, light to medium-bodied with notes of wild strawberry, cherry, watermelon.", aroma: "Red berries (strawberry, raspberry), rose petal, orange peel, white peach.", pairings: ["Smoked Salmon Plate", "Wine Country Sangria", "Mahi and Meyer Lemon Sandwich", "Heirloom Tomato and Peach Burrata"], tags: ["Light", "Crisp", "Dry", "Fruity", "Refreshing"], note: "A portion of proceeds supports breast cancer research.", body: "Light"},
    { name: "La Croix Peyrassol Rosé", type: "Rosé", availability: "By glass or bottle", region: "Côtes de Provence, France", grapes: "Cinsault, Grenache, Syrah", taste: "Pale, bone-dry, elegant, light-bodied with crisp acidity, delicate red berries, peach.", aroma: "Fresh strawberry, white peach, citrus blossom, subtle herbs (thyme), wet stone.", pairings: ["Coastal Chickpea and Salmon", "Mahi and Meyer Lemon Sandwich", "Wine Country Sangria Salad", "Smoked Salmon Plate"], tags: ["Light", "Crisp", "Dry", "Elegant", "Mineral", "Classic"], body: "Light"},
    { name: "La Grangette Côtes du Rhône", type: "Red", availability: "By glass or bottle", region: "Rhône Valley, France", grapes: "Grenache, Syrah, Mourvèdre (GSM blend)", taste: "Medium-bodied, soft tannins, ripe red fruits, earthy, spicy undertones.", aroma: "Black cherry, raspberry, garrigue (herbs), white pepper, dusty earth.", pairings: ["French Style Omelet", "Sun Kissed Pancakes", "Green Goddess", "Spicy Calabrese Flatbread"], tags: ["Earthy", "Spicy", "Medium-Bodied", "Fruity"], tannins: "Soft"},
    { name: "Gundlach Bundschu Cabernet Blend", type: "Red", availability: "By glass or bottle", region: "Sonoma Valley, California", grapes: "Cabernet Sauvignon, Merlot", taste: "Full-bodied, structured tannins, dark fruit, soft Merlot roundness, notes of oak, cocoa.", aroma: "Blackcurrant, plum, tobacco, mocha, hints of graphite, cedar, vanilla.", pairings: ["Crab Cake Benny", "Smoked Salmon Plate", "Shakshuka"], tags: ["Bold", "Rich", "Full-Bodied", "Oaked", "Structured"], tannins: "Structured"},
    { name: "Handley Pinot Noir", type: "Red", availability: "By glass or bottle", region: "Anderson Valley, California", grapes: "Pinot Noir", taste: "Light to medium-bodied, silky texture, bright acidity, red fruit-driven, elegant and earthy.", aroma: "Cherry, cranberry, rose petals, forest floor, tea leaf, spice.", pairings: ["Modern Ceasar Salad with Salmon", "Green Goddess", "Coastal Chickpea and Salmon"], tags: ["Light", "Earthy", "Elegant", "Fruity"], tannins: "Soft"},
    { name: "Alexana Pinot Noir (Dundee Hills)", type: "Red", availability: "By bottle only", region: "Willamette Valley, Oregon", grapes: "Pinot Noir", taste: "Medium-bodied, vibrant acidity, structured but refined, ripe red fruit, earthy tones.", aroma: "Ripe cherry, raspberry, pomegranate, hints of cola, earth, dried herbs.", pairings: ["Costal Chickpea and Salmon", "Green Goddess", "Heirloom Tomato & Peach Burrata"], tags: ["Earthy", "Elegant", "Fruity", "Structured", "Medium-Bodied"], tannins: "Medium"},
    { name: "Flanagan Cabernet Sauvignon", type: "Red", availability: "By glass or bottle", region: "Sonoma or Napa, California", grapes: "Cabernet Sauvignon", taste: "Full-bodied, intense, firm tannins, dark concentrated fruit, well-integrated oak.", aroma: "Blackberry, cassis, espresso, dark chocolate, toasted oak, vanilla, tobacco.", pairings: ["Breakfast burrito", "Shakshuka"], tags: ["Bold", "Rich", "Full-Bodied", "Oaked", "Structured", "Intense"], tannins: "Firm"},
    { name: "RouteStock Cabernet Sauvignon (Route 29)", type: "Red", availability: "By glass or bottle", region: "Napa Valley, California", grapes: "Cabernet Sauvignon", taste: "Full-bodied, rich and smooth, ripe dark fruit, polished tannins.", aroma: "Blackberry, black cherry, mocha, vanilla, cedar, baking spices.", pairings: ["Shakshuka", "Spicy Calabrese Flatbread", "Breakfast Burrito"], tags: ["Bold", "Rich", "Full-Bodied", "Oaked", "Smooth"], tannins: "Structured"},
    { name: "Hall Cabernet Sauvignon", type: "Red", availability: "By glass or bottle", region: "Napa Valley, California", grapes: "95% Cabernet Sauvignon, 5% Merlot", taste: "Powerful, opulent, full-bodied with bold tannins and lush fruit.", aroma: "Cassis, blueberry, licorice, graphite, dark chocolate, toasty oak.", pairings: ["Breakfast Burrito", "Ham & Cheese croissant", "Green Goddess"], tags: ["Bold", "Rich", "Full-Bodied", "Oaked", "Structured", "Intense"], tannins: "Firm"},
    { name: "Frank Family Cabernet Sauvignon", type: "Red", availability: "By bottle only", region: "Napa Valley, California", grapes: "Cabernet Sauvignon, etc.", taste: "Rich, velvety, dark berries, firm tannins, plush texture.", aroma: "Blackberry, plum, vanilla bean, espresso, caramel, baking spice.", pairings: ["Ham and Cheese Croissant", "Coastal Chickpea and Salmon", "Shakshuka"], tags: ["Bold", "Rich", "Full-Bodied", "Oaked", "Smooth", "Structured"], tannins: "Firm"},
    { name: "Château Anthonic Moulis-en-Médoc (Bordeaux)", type: "Red", availability: "By glass or bottle", region: "Left Bank, Bordeaux, France", grapes: "Merlot-dominant, Cabernet Sauvignon, etc.", taste: "Medium to full-bodied, earthy structure, firm tannins, restrained elegance.", aroma: "Blackcurrant, plum, graphite, tobacco, leather, cedar.", pairings: ["Shakshuka", "Breakfast Burrito", "Spicy Calabrese Flatbread"], tags: ["Earthy", "Structured", "Classic", "Medium-Bodied", "Old World"], tannins: "Firm"},
    { name: "Shafer TD-9 (Bordeaux Blend)", type: "Red", availability: "By bottle only", region: "Napa Valley, California", grapes: "Merlot, Cabernet Sauvignon, Malbec", taste: "Full-bodied, smooth, fruit-forward, silky tannins, lush mid-palate, rich dark fruit.", aroma: "Ripe plum, blackberry, blueberry, mocha, anise, baking spice.", pairings: ["Shakshuka", "Spicy Calabrese Flatbread", "Breakfast Burrito"], tags: ["Bold", "Rich", "Full-Bodied", "Smooth", "Fruity"], tannins: "Soft"},
    { name: "Gaja Ca’Marcanda Promis Toscana IGT", type: "Red", availability: "By bottle only", region: "Tuscany, Italy", grapes: "Merlot, Syrah, Sangiovese", taste: "Medium to full-bodied, polished tannins, good acidity, juicy and balanced.", aroma: "Black cherry, blackberry, licorice, Mediterranean herbs, cocoa, dried rose.", pairings: ["Breakfast Burrito", "Smashed Avocado BLT", "Ham and Cheese Croissant", "Crab Cake Benny"], tags: ["Medium-Bodied", "Smooth", "Fruity", "Earthy", "Spicy", "Italian"], tannins: "Medium"}
];


// ===================================================================================
// ===== JAVASCRIPT LOGIC =====
// ===================================================================================
document.addEventListener('DOMContentLoaded', () => {
    // --- Universal Navigation ---
    function setupNav(navSelector, contentSelector, sectionClass) {
        const navBtns = document.querySelectorAll(navSelector);
        const contents = document.querySelectorAll(contentSelector);
        navBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                navBtns.forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                contents.forEach(content => {
                    content.classList.remove('active');
                    if (content.id === btn.dataset.target) {
                        content.classList.add('active');
                        // Special triggers for quiz generation
                        if (content.id === 'quiz-tool') generateQuiz();
                    }
                });
            });
        });
    }
    setupNav('.main-nav-btn', '.content-section');
    setupNav('#study-sub-nav .sub-nav-btn', '#study-section .tool-content');
    setupNav('#service-sub-nav .sub-nav-btn', '#service-section .tool-content');

    // --- Flashcard Logic ---
    let currentCardIndex = 0;
    const flashcard = document.getElementById('flashcard');
    const frontContent = document.getElementById('flashcard-front-content');
    const backContent = document.getElementById('flashcard-back-content');
    const prevBtn = document.getElementById('prev-card');
    const nextBtn = document.getElementById('next-card');
    const cardCounter = document.getElementById('card-counter');

    function updateFlashcard() {
        const wine = wineData[currentCardIndex];
        frontContent.textContent = wine.name;
        backContent.innerHTML = `
            <h3>Details</h3>
            <p><strong>Region:</strong> ${wine.region}</p>
            <p><strong>Grapes:</strong> ${wine.grapes}</p>
            <p><strong>Availability:</strong> ${wine.availability}</p>
            <h3>Taste Profile</h3><p>${wine.taste}</p>
            <h3>Aromatic Profile</h3><p>${wine.aroma}</p>
            <h3>Food Pairings</h3><ul>${wine.pairings.map(p => `<li>${p}</li>`).join('')}</ul>
            ${wine.note ? `<p class="note">${wine.note}</p>` : ''}
        `;
        cardCounter.textContent = `${currentCardIndex + 1} / ${wineData.length}`;
        flashcard.classList.remove('is-flipped');
    }

    if (flashcard) {
        flashcard.addEventListener('click', () => flashcard.classList.toggle('is-flipped'));
        prevBtn.addEventListener('click', () => {
            currentCardIndex = (currentCardIndex - 1 + wineData.length) % wineData.length;
            updateFlashcard();
        });
        nextBtn.addEventListener('click', () => {
            currentCardIndex = (currentCardIndex + 1) % wineData.length;
            updateFlashcard();
        });
    }

    // --- Quiz Logic ---
    const quizContainer = document.getElementById('quiz-container');
    const submitQuizBtn = document.getElementById('submit-quiz-btn');
    const quizResultsContainer = document.getElementById('quiz-results');

    function generateQuiz() {
        if (!quizContainer) return;
        quizContainer.innerHTML = '';
        quizResultsContainer.innerHTML = '';
        const questions = generateQuizQuestions(5);

        questions.forEach((q, index) => {
            const questionEl = document.createElement('div');
            questionEl.classList.add('quiz-question');
            questionEl.innerHTML = `
                <p>${index + 1}. ${q.question}</p>
                <div class="quiz-options" data-correct-answer="${q.answer}">
                    ${q.options.map((opt, i) => `
                        <label>
                            <input type="radio" name="q${index}" value="${opt}">
                            <span>${opt}</span>
                        </label>
                    `).join('')}
                </div>
                <div class="result-feedback"></div>`;
            quizContainer.appendChild(questionEl);
        });
    }

    if (submitQuizBtn) {
        submitQuizBtn.addEventListener('click', () => {
            let score = 0;
            const allQuestions = quizContainer.querySelectorAll('.quiz-options');
            allQuestions.forEach((questionDiv, index) => {
                const correctAnswer = questionDiv.dataset.correctAnswer;
                const selected = questionDiv.querySelector(`input[name="q${index}"]:checked`);
                const feedbackEl = questionDiv.nextElementSibling;
                if(selected) {
                    if(selected.value === correctAnswer) {
                        score++;
                        feedbackEl.textContent = 'Correct!';
                        feedbackEl.style.color = 'var(--success-color)';
                    } else {
                        feedbackEl.innerHTML = `Incorrect. The correct answer is: <strong>${correctAnswer}</strong>`;
                        feedbackEl.style.color = 'var(--error-color)';
                    }
                } else {
                    feedbackEl.innerHTML = `No answer selected. Correct: <strong>${correctAnswer}</strong>`;
                    feedbackEl.style.color = 'var(--error-color)';
                }
            });
            quizResultsContainer.textContent = `You scored ${score} out of ${allQuestions.length}!`;
        });
    }

    function generateQuizQuestions(num) {
        let questions = [];
        const shuffledWines = [...wineData].sort(() => 0.5 - Math.random());
        for (let i = 0; i < num; i++) {
            const wine = shuffledWines[i];
            const type = Math.floor(Math.random() * 3); // 0: Region, 1: Grapes, 2: Pairing
            let q, a, opts;
            switch(type) {
                case 1:
                    q = `What are the primary grapes in ${wine.name}?`;
                    a = wine.grapes;
                    opts = getOptions(a, wineData.map(w => w.grapes));
                    break;
                case 2:
                    const pairing = wine.pairings[Math.floor(Math.random() * wine.pairings.length)];
                    q = `Which of these wines pairs best with ${pairing}?`;
                    a = wine.name;
                    opts = getOptions(a, wineData.map(w => w.name));
                    break;
                default:
                    q = `Which region is ${wine.name} from?`;
                    a = wine.region;
                    opts = getOptions(a, wineData.map(w => w.region));
                    break;
            }
            questions.push({ question: q, answer: a, options: opts });
        }
        return questions;
    }

    function getOptions(correctAnswer, allOptions) {
        const options = new Set([correctAnswer]);
        const distinctOptions = [...new Set(allOptions.filter(o => o !== correctAnswer))];
        while (options.size < 4 && distinctOptions.length > 0) {
            options.add(distinctOptions.splice(Math.floor(Math.random() * distinctOptions.length), 1)[0]);
        }
        return [...options].sort(() => 0.5 - Math.random());
    }

    // --- Visuals Logic ---
    function generateVisuals() {
        const whiteBodyChart = document.getElementById('white-body-chart');
        const redTanninChart = document.getElementById('red-tannin-chart');
        if (!whiteBodyChart || !redTanninChart) return;
        whiteBodyChart.innerHTML = '';
        redTanninChart.innerHTML = '';
        
        const bodyScale = { 'Light': 33, 'Medium': 66, 'Full': 100 };
        const whitesAndRose = wineData.filter(w => w.type === 'White' || w.type === 'Rosé').sort((a,b) => bodyScale[a.body] - bodyScale[b.body]);
        whitesAndRose.forEach(wine => {
            if(!wine.body) return;
            whiteBodyChart.innerHTML += `
                <div class="bar-chart-item">
                    <div class="bar-label" title="${wine.name}">${wine.name}</div>
                    <div class="bar-wrapper"><div class="bar" style="width: ${bodyScale[wine.body]}%;">${wine.body}</div></div>
                </div>`;
        });
        
        const tanninScale = { 'Soft': 33, 'Medium': 66, 'Structured': 85, 'Firm': 100 };
        const reds = wineData.filter(w => w.type === 'Red').sort((a,b) => tanninScale[a.tannins] - tanninScale[b.tannins]);
         reds.forEach(wine => {
            if(!wine.tannins) return;
            redTanninChart.innerHTML += `
                <div class="bar-chart-item">
                    <div class="bar-label" title="${wine.name}">${wine.name}</div>
                    <div class="bar-wrapper"><div class="bar" style="width: ${tanninScale[wine.tannins]}%; background: linear-gradient(90deg, #c62828, #880e4f);">${wine.tannins}</div></div>
                </div>`;
        });
    }

    // --- Recommender Logic ---
    const filterContainer = document.getElementById('filter-container');
    const filterResults = document.getElementById('filter-results');
    
    function initializeRecommender() {
        if (!filterContainer) return;
        const allTags = [...new Set(wineData.flatMap(w => w.tags))].sort();
        filterContainer.innerHTML = `
            <div class="filter-group">
                <div class="filter-tags">
                ${allTags.map(tag => `
                    <input type="checkbox" id="tag-${tag.replace(/\s+/g, '-')}" value="${tag}" class="filter-checkbox">
                    <label for="tag-${tag.replace(/\s+/g, '-')}">${tag}</label>
                `).join('')}
                </div>
            </div>`;
        
        const filterCheckboxes = document.querySelectorAll('.filter-checkbox');
        filterCheckboxes.forEach(box => box.addEventListener('change', updateFilteredResults));
    }

    function updateFilteredResults() {
        const selectedTags = [...document.querySelectorAll('.filter-checkbox:checked')].map(box => box.value);
        if (selectedTags.length === 0) {
            filterResults.innerHTML = '<p>Select one or more tags above to see matching wines.</p>';
            return;
        }
        const filteredWines = wineData.filter(wine => selectedTags.every(tag => wine.tags.includes(tag)));

        if(filteredWines.length === 0) {
            filterResults.innerHTML = '<p>No wines match that specific combination. Try removing a filter.</p>';
            return;
        }
        
        filterResults.innerHTML = filteredWines.map(wine => `
            <div class="wine-card">
                <h4>${wine.name}</h4>
                <p><strong>${wine.type} from ${wine.region}</strong></p>
                <p><strong>Profile:</strong> ${wine.taste}</p>
                ${wine.note ? `<p class="note">${wine.note}</p>` : ''}
            </div>`).join('');
    }

    // --- Food Pairing Logic ---
    const foodMenuContainer = document.getElementById('food-menu-container');
    const pairingResultsContainer = document.getElementById('pairing-results');

    function initializeFoodPairing() {
        if (!foodMenuContainer) return;
        const allMenuItems = [...new Set(wineData.flatMap(w => w.pairings))].sort();
        foodMenuContainer.innerHTML = allMenuItems.map(item => `
            <div class="food-card" data-food-item="${item}"><h3>${item}</h3></div>`).join('');
        
        foodMenuContainer.querySelectorAll('.food-card').forEach(card => {
            card.addEventListener('click', () => {
                // visual selection
                foodMenuContainer.querySelectorAll('.food-card').forEach(c => c.classList.remove('selected'));
                card.classList.add('selected');

                const foodItem = card.dataset.foodItem;
                const pairedWines = wineData.filter(wine => wine.pairings.includes(foodItem));
                
                pairingResultsContainer.innerHTML = `
                    <h3>Best Pairings for: <strong>${foodItem}</strong></h3>
                    <div class="results-grid">
                        ${pairedWines.map(wine => `
                            <div class="wine-card">
                                <h4>${wine.name}</h4>
                                <p><strong>${wine.type} from ${wine.region}</strong></p>
                                <p><strong>Why it works:</strong> ${wine.taste}</p>
                                ${wine.note ? `<p class="note">${wine.note}</p>` : ''}
                            </div>`).join('')}
                    </div>`;
                pairingResultsContainer.scrollIntoView({ behavior: 'smooth', block: 'start' });
            });
        });
    }

    // --- Initial Load ---
    updateFlashcard();
    generateVisuals();
    initializeRecommender();
    initializeFoodPairing();
    if(document.querySelector('.sub-nav-btn[data-target="quiz-tool"]')) {
      document.querySelector('.sub-nav-btn[data-target="quiz-tool"]').addEventListener('click', generateQuiz);
    }
});
</script>

</body>
</html>```
