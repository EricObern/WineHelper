<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sommelier's Assistant</title>
    <style>
        :root {
            --bg-color: #f8f7f2; /* Sandy Off-White */
            --text-color: #2c3e50; /* Dark Slate Blue */
            --primary-color: #0077b6; /* Professional Blue */
            --accent-color: #e67e22; /* Warm Orange for highlights */
            --light-gray: #ecf0f1;
            --card-bg: #ffffff;
            --shadow-color: rgba(44, 62, 80, 0.15);
            --success-color: #27ae60;
            --error-color: #c0392b;
        }

        /* --- Base & Typography --- */
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
            margin: 0;
            padding: 0;
            background-color: var(--bg-color);
            color: var(--text-color);
            font-size: 16px;
            line-height: 1.6;
        }
        .container { max-width: 1200px; margin: 0 auto; padding: 15px; }
        h1, h2, h3, h4 { color: var(--text-color); margin-top: 0; }
        h2 { margin-bottom: 20px; }
        p { margin-top: 0; }
        strong { color: #34495e; }

        /* --- Animations --- */
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* --- Layout & Navigation --- */
        header {
            background-color: var(--card-bg);
            padding: 20px 15px;
            text-align: center;
            box-shadow: 0 2px 8px var(--shadow-color);
            border-bottom: 4px solid var(--primary-color);
        }
        header h1 { margin: 0; font-size: 2em; }
        .main-nav {
            display: flex;
            margin: 20px 0;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 2px 4px var(--shadow-color);
        }
        .main-nav-btn {
            padding: 15px 10px;
            border: none;
            background-color: var(--light-gray);
            color: var(--primary-color);
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            flex-grow: 1;
            text-align: center;
        }
        .main-nav-btn.active {
            background-color: var(--primary-color);
            color: var(--card-bg);
        }
        .content-section { display: none; animation: fadeIn 0.4s; }
        .content-section.active { display: block; }

        .tool-container { padding: 20px; background-color: var(--card-bg); border-radius: 12px; box-shadow: 0 2px 6px var(--shadow-color); }
        .sub-nav { display: flex; flex-wrap: wrap; gap: 10px; margin-bottom: 20px; border-bottom: 2px solid var(--light-gray); padding-bottom: 15px; }
        .sub-nav-btn {
            padding: 8px 18px;
            border: 1px solid var(--primary-color);
            background-color: var(--card-bg);
            color: var(--primary-color);
            border-radius: 50px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
        }
        .sub-nav-btn.active { background-color: var(--primary-color); color: var(--card-bg); }
        .tool-content { display: none; }
        .tool-content.active { display: block; }

        /* --- Reusable Components --- */
        .button {
            padding: 12px 24px; font-size: 1.1em; font-weight: bold; cursor: pointer;
            background-color: var(--accent-color); color: var(--card-bg);
            border: none; border-radius: 8px; transition: background-color 0.3s;
            display: block; width: 100%; margin-top: 15px; box-sizing: border-box; text-align: center;
        }
        .button:hover { background-color: #d35400; }
        .wine-card {
            background: var(--card-bg); border: 1px solid var(--light-gray);
            border-left: 5px solid var(--primary-color); border-radius: 8px;
            padding: 15px; box-shadow: 0 2px 5px var(--shadow-color); margin-bottom: 15px;
        }
        .hook-note { font-style: italic; color: #555; margin-top: 10px; padding: 10px; background-color: #fcfcfc; border-left: 3px solid var(--light-gray); }

        /* --- Study Mode: Flashcards --- */
        #flashcard-container { display: grid; gap: 15px; }
        .flashcard-details {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.5s ease-out;
            border-top: 1px solid var(--light-gray);
            margin-top: 10px;
            padding-top: 0;
        }
        .flashcard-details.visible { max-height: 500px; padding-top: 10px; }
        .details-toggle-btn {
            background: var(--light-gray); border: none; padding: 8px 12px;
            border-radius: 5px; font-weight: bold; cursor: pointer;
        }

        /* --- Study Mode: Smart Quiz --- */
        .quiz-question { margin-bottom: 20px; padding: 15px; border: 1px solid var(--light-gray); border-radius: 8px; }
        .quiz-options label {
            display: block; margin: 8px 0; padding: 12px;
            background: var(--light-gray); border-radius: 8px;
            cursor: pointer; border-left: 5px solid transparent; transition: all 0.2s ease;
        }
        .quiz-options label.correct { border-color: var(--success-color); background-color: #eafaf1; font-weight: bold; }
        .quiz-options label.incorrect { border-color: var(--error-color); background-color: #fbeeeead; }
        #quiz-results { margin-top: 20px; padding: 15px; font-size: 1.2em; font-weight: bold; text-align: center; border-radius: 8px;}
        #quiz-results.success { background-color: #eafaf1; color: var(--success-color); }
        #quiz-results.failure { background-color: #fbeeeead; color: var(--error-color); }

        /* --- Study Mode: Visual Explorer --- */
        #visual-wine-list {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 20px;
        }
        .wine-plot-item {
            padding: 5px 10px;
            background-color: var(--light-gray);
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.2s;
        }
        .wine-plot-item.selected { background-color: var(--accent-color); color: white; }
        .spectrum-chart { margin-bottom: 20px; }
        .spectrum-chart h4 { text-align: center; margin-bottom: 8px; font-size: 1em; }
        .spectrum-bar-container { background-color: var(--light-gray); border-radius: 5px; }
        .spectrum-bar {
            height: 25px;
            background: linear-gradient(90deg, var(--primary-color), var(--accent-color));
            border-radius: 5px;
            width: 0;
            transition: width 0.6s ease-out;
        }
        .spectrum-legend { display: flex; justify-content: space-between; font-size: 0.8em; font-weight: 500; padding: 0 5px;}
        .group-buttons { display: flex; flex-wrap: wrap; gap: 10px; margin-bottom: 20px; }
        .group-btn {
            padding: 8px 15px; border: 1px solid var(--primary-color);
            background-color: var(--card-bg); color: var(--primary-color);
            border-radius: 20px; cursor: pointer; font-weight: 500;
        }
        .group-btn.active { background-color: var(--primary-color); color: var(--card-bg); }
        .comparison-grid { display: grid; gap: 15px; }
        .comparison-card { padding: 15px; background: var(--light-gray); border-radius: 8px; }

        /* --- Service Mode --- */
        .filter-tags { display: flex; flex-wrap: wrap; gap: 8px; margin: 15px 0; }
        .filter-tags label {
            padding: 8px 15px; background-color: var(--light-gray);
            border-radius: 20px; cursor: pointer; user-select: none; transition: all 0.2s ease;
        }
        .filter-tags input { display: none; }
        .filter-tags input:checked + label {
            background-color: var(--primary-color); color: var(--card-bg); box-shadow: 0 1px 3px var(--shadow-color);
        }
        .match-card ul { margin: 10px 0 0 0; padding-left: 20px; }
        .match-card li.match { color: var(--success-color); }
        .match-card li.mismatch { color: var(--error-color); }

        .food-pairing-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 10px; }
        .food-card {
            padding: 15px; text-align: center; font-weight: bold; background-color: var(--card-bg);
            border-radius: 8px; box-shadow: 0 1px 3px var(--shadow-color); cursor: pointer;
            border: 1px solid var(--light-gray); transition: all 0.2s ease;
        }
        .food-card:hover, .food-card.selected {
            transform: translateY(-3px); box-shadow: 0 3px 8px var(--shadow-color);
            background-color: var(--primary-color); color: var(--card-bg);
        }
        #pairing-results .special-note {
            background-color: #eafaf1; border-left: 4px solid var(--success-color);
            padding: 10px; margin: 15px 0; border-radius: 4px;
        }
        .pairing-reason { font-style: italic; background-color: #f8f9fa; padding: 8px; border-radius: 5px; margin-top: 8px; }
    </style>
</head>
<body>

    <header>
        <h1>Sommelier's Assistant</h1>
    </header>

    <div class="container">
        <nav class="main-nav">
            <button class="main-nav-btn active" data-target="study-section">Study Mode</button>
            <button class="main-nav-btn" data-target="service-section">Service Mode</button>
        </nav>

        <main>
            <!-- ===================== -->
            <!-- ===== STUDY MODE ==== -->
            <!-- ===================== -->
            <section id="study-section" class="content-section active">
                <div class="tool-container">
                    <nav class="sub-nav">
                        <button class="sub-nav-btn active" data-target="flashcards-tool">Flashcards</button>
                        <button class="sub-nav-btn" data-target="quiz-tool">Smart Quiz</button>
                        <button class="sub-nav-btn" data-target="visuals-tool">Visual Explorer</button>
                    </nav>

                    <!-- Flashcards Tool -->
                    <div id="flashcards-tool" class="tool-content active">
                        <h2>Flashcards</h2>
                        <div id="flashcard-container"></div>
                    </div>

                    <!-- Smart Quiz Tool -->
                    <div id="quiz-tool" class="tool-content">
                        <h2>Smart Quiz</h2>
                        <p>A new 5-question quiz is generated each time. Get instant feedback on your answers.</p>
                        <div id="quiz-container"></div>
                        <div id="quiz-results"></div>
                        <button id="new-quiz-btn" class="button">New Quiz</button>
                    </div>

                    <!-- Visual Explorer Tool -->
                    <div id="visuals-tool" class="tool-content">
                        <nav class="sub-nav">
                            <button class="sub-nav-btn active" data-target="spectrum-analyzer">Spectrum Analyzer</button>
                            <button class="sub-nav-btn" data-target="comparative-groupings">Comparative Groupings</button>
                        </nav>
                        <div id="spectrum-analyzer" class="tool-content active">
                            <h3>Spectrum Analyzer</h3>
                            <p>Select a wine to see where it falls on each spectrum.</p>
                            <div id="visual-wine-list"></div>
                            <div id="spectrum-charts-container"><p>Select a wine above to begin.</p></div>
                        </div>
                        <div id="comparative-groupings" class="tool-content">
                             <h3>Comparative Groupings</h3>
                            <p>Select a grape to compare all available options side-by-side.</p>
                            <div class="group-buttons" id="group-buttons-container"></div>
                            <div class="comparison-grid" id="comparison-container"></div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- ======================= -->
            <!-- ===== SERVICE MODE ==== -->
            <!-- ======================= -->
            <section id="service-section" class="content-section">
                 <div class="tool-container">
                    <nav class="sub-nav">
                        <button class="sub-nav-btn active" data-target="recommender-tool">Intelligent Recommender</button>
                        <button class="sub-nav-btn" data-target="pairing-tool">Food Pairing Guide</button>
                    </nav>

                    <!-- Recommender Tool -->
                    <div id="recommender-tool" class="tool-content active">
                        <h2>Intelligent Recommender</h2>
                        <p>Select tags based on your guest's preferences to get scored recommendations.</p>
                        <div id="filter-container"></div>
                        <h3>Recommendations</h3>
                        <div id="filter-results"><p>Select tags to see recommendations.</p></div>
                    </div>

                    <!-- Food Pairing Tool -->
                    <div id="pairing-tool" class="tool-content">
                        <h2>Food Pairing Guide</h2>
                        <p>Select a menu item to see ideal pairings and why they work.</p>
                        <div id="food-menu-container" class="food-pairing-grid"></div>
                        <div id="pairing-results"></div>
                    </div>
                </div>
            </section>
        </main>
    </div>

<script>
// ===================================================================================
// ===== PART 1: SOURCE OF TRUTH (DATA) ==============================================
// ===================================================================================

const wineData = [
    { id: 1, name: "Giavi DOCG Rosé Prosecco", type: "Sparkling", grape: "Glera", region: "Veneto, Italy", grapes: "Glera, Pinot Noir", taste: "Light-bodied, crisp, dry. Notes of red berries (wild strawberry, raspberry) with bright citrus freshness and a hint of rose petals.", pairings: ["Wine Country Sangria Salad", "Heirloom Tomato Burrata", "Watermelon Seasonal Fruit bowl", "Vanilla Yogurt and Granola Bowl"], tags: ["Light", "Crisp", "Bubbly", "Fruity", "Refreshing"], scales: { body: 2, acidity: 4, fruit: 4 }, hook: "A high-quality DOCG Prosecco, meaning the grapes come from the best, steepest hills in the region." },
    { id: 2, name: "Bisol Jeio Brut Prosecco", type: "Sparkling", grape: "Glera", region: "Valdobbiadene, Veneto, Italy", grapes: "Glera", taste: "Crisp and clean with vibrant acidity. Dominated by pear, green apple, and citrus with a smooth, dry finish.", pairings: ["Modern Caesar Salad", "Watermelon Seasonal Fruit bowl", "Wine Country Sangria Salad", "Green Goddess"], tags: ["Light", "Crisp", "Bubbly", "Dry", "Orchard Fruit"], scales: { body: 2, acidity: 4, fruit: 3 }, hook: "From a family that has been making wine in the heart of Valdobbiadene for 21 generations." },
    { id: 3, name: "Allimant-Laugner Crémant d'Alsace Brut", type: "Sparkling", grape: "Pinot Blanc", region: "Alsace, France", grapes: "Pinot Blanc, Auxerrois, Riesling", taste: "Elegant and refined with a creamy texture. Flavors of green apple, pear, and a distinct note of brioche or freshly baked bread.", pairings: ["Smoked Salmon Plate", "French Style Omelet", "Modern Caesar Salad", "Mahi and Meyer Lemon Sandwich"], tags: ["Elegant", "Creamy", "Bubbly", "Toasty", "Dry"], scales: { body: 3, acidity: 4, fruit: 2 }, hook: "Crémant is France's answer to high-quality sparkling wine outside of Champagne, often offering incredible value." },
    { id: 4, name: "Taittinger Brut La Française Champagne", type: "Sparkling", grape: "Chardonnay", region: "Champagne, France", grapes: "Chardonnay, Pinot Noir, Pinot Meunier", taste: "Medium-bodied and perfectly balanced. Flavors of apple, peach, and toasted brioche with a creamy, persistent mousse.", pairings: ["Crab Cake Benny", "Ham and Cheese Croissant", "French Style Omelet", "Heirloom Tomato Burrata"], tags: ["Classic", "Creamy", "Bubbly", "Toasty", "Elegant", "Rich"], scales: { body: 3, acidity: 4, fruit: 3 }, hook: "A benchmark non-vintage Champagne, known for its high percentage of Chardonnay, giving it elegance and finesse." },
    { id: 5, name: "Sea Cove Sauvignon Blanc", type: "White", grape: "Sauvignon Blanc", region: "Marlborough, New Zealand", taste: "Light-bodied and zesty with high, refreshing acidity. Pungent notes of passionfruit, grapefruit, lime, and fresh-cut grass.", pairings: ["Smoked Salmon Plate", "Coastal Chickpea and Salmon", "Wine Country Sangria Salad", "Mahi and Meyer Lemon Sandwich"], tags: ["Light", "Crisp", "Zesty", "Grassy", "Refreshing", "Tropical"], scales: { body: 2, acidity: 5, fruit: 5 }, hook: "A classic, unmistakable example of Marlborough Sauvignon Blanc, the style that put New Zealand on the world wine map." },
    { id: 6, name: "Hourglass Sauvignon Blanc", type: "White", grape: "Sauvignon Blanc", region: "Napa Valley, California", grapes: "91% Sauvignon Blanc, 9% Sémillon", taste: "Medium-bodied with a richer, rounder texture from the Sémillon. Notes of white peach, melon, and lemongrass with a hint of creaminess.", pairings: ["Mahi and Meyer Lemon Sandwich", "Green Goddess", "Wine Country Sangria Salad", "Heirloom Tomato Burrata"], tags: ["Medium-Bodied", "Rich", "Fruity", "Elegant", "Creamy"], scales: { body: 3, acidity: 4, fruit: 4 }, hook: "The small addition of Sémillon gives this a richer texture, setting it apart from grassy styles. Think more lush and less zesty." },
    { id: 7, name: "Daniel Reverdy Sancerre", type: "White", grape: "Sauvignon Blanc", region: "Loire Valley, France", taste: "Light to medium-bodied, bone-dry with chiseled minerality. Flavors of lime, flint, wet stone, and subtle white flowers.", pairings: ["Modern Caesar Salad", "French Style Omelet", "Wine Country Sangria Salad", "Heirloom Tomato Burrata"], tags: ["Light", "Crisp", "Dry", "Mineral", "Elegant", "Flinty"], scales: { body: 2, acidity: 5, fruit: 2 }, hook: "Sancerre is the French blueprint for Sauvignon Blanc. It's all about minerality and elegance over powerful fruit." },
    { id: 8, name: "La Marea Albariño", type: "White", grape: "Albariño", region: "Monterey, California", taste: "Light, crisp, and dry with a distinct saline or sea-spray quality. Flavors of lemon zest, apricot, and white flowers.", pairings: ["Shakshuka", "Coastal Chickpea and Salmon", "Smoked Salmon Plate", "Mahi and Meyer Lemon Sandwich", "Modern Caesar Salad"], tags: ["Crisp", "Mineral", "Fruity", "Refreshing", "Coastal", "Saline"], scales: { body: 2, acidity: 4, fruit: 3 }, hook: "Albariño is famously from coastal Spain, and this Californian version captures that same refreshing, seaside character." },
    { id: 9, name: "Hill Family White Barrel Blend", type: "White", grape: "Chardonnay", region: "Napa Valley, California", grapes: "Chardonnay, Sauvignon Blanc", taste: "Medium to full-bodied with a creamy texture from oak. Ripe fruit like baked apple and melon, with vanilla and spice notes.", pairings: ["Crab Cake Benny", "French Style Omelet", "Smoked Salmon Plate", "Coastal Chickpea and Salmon"], tags: ["Rich", "Creamy", "Full-Bodied", "Oaked"], scales: { body: 4, acidity: 3, fruit: 4 }, hook: "A unique blend where Chardonnay brings richness and Sauvignon Blanc adds a touch of citrus lift." },
    { id: 10, name: "Elena Walch Pinot Grigio", type: "White", grape: "Pinot Grigio", region: "Alto Adige, Italy", taste: "Light-bodied, crisp, and dry with lively acidity. Clean notes of green apple, pear, and a hint of almond.", pairings: ["Mahi and Meyer Lemon Sandwich", "Green Goddess", "Orchard Chicken Salad Croissant", "Heirloom Tomato Burrata"], tags: ["Light", "Crisp", "Dry", "Refreshing", "Mineral"], scales: { body: 2, acidity: 4, fruit: 3 }, hook: "This is from Alto Adige, a high-altitude region in Northern Italy known for producing the most aromatic and crisp Pinot Grigio." },
    { id: 11, name: "Eric Variet Bourgogne Aligoté", type: "White", grape: "Aligoté", region: "Burgundy, France", taste: "Very light-bodied, bone-dry with high, zesty acidity. Flavors of lemon, green apple, and a chalky, flinty character.", pairings: ["Smoked Salmon Plate", "Coastal Chickpea and Salmon", "Green Goddess", "Modern Caesar Salad"], tags: ["Light", "Crisp", "Dry", "Mineral", "Zesty"], scales: { body: 1, acidity: 5, fruit: 2 }, hook: "Aligoté is Burgundy's 'other' white grape. A favorite of locals and sommeliers for its bracing acidity." },
    { id: 12, name: "RouteStock Route 121 Chardonnay", type: "White", grape: "Chardonnay", region: "Carneros, California", taste: "Medium to full-bodied with balanced oak and acidity. Creamy texture with notes of baked apple, lemon curd, and toasted brioche.", pairings: ["Mahi and Meyer Lemon Sandwich", "Heirloom Tomato Burrata", "Smoked Salmon Plate", "Modern Caesar Salad"], tags: ["Rich", "Creamy", "Oaked", "Full-Bodied", "Toasty", "Balanced"], scales: { body: 4, acidity: 4, fruit: 4 }, hook: "From Carneros, a cool-climate region perfect for Chardonnay that is both ripe and refreshing." },
    { id: 13, name: "ZD Chardonnay", type: "White", grape: "Chardonnay", region: "Napa Valley, California", taste: "Full-bodied, rich, and luxurious. Low acidity. Lush notes of pineapple and mango, with prominent vanilla bean and toasty oak.", pairings: ["Crab Cake Benny", "Smoked Salmon Plate", "Heirloom Tomato Burrata", "Orchard Chicken Salad Croissant"], tags: ["Rich", "Creamy", "Full-Bodied", "Oaked", "Fruity", "Buttery"], scales: { body: 5, acidity: 2, fruit: 5 }, hook: "A classic, bold, and unapologetic style of Napa Chardonnay. Fermented in American Oak for a richer, more powerful profile." },
    { id: 14, name: "Paul Lato Chardonnay", type: "White", grape: "Chardonnay", availability: "By bottle only", region: "Santa Barbara, California", taste: "Full-bodied yet elegant and balanced. Vibrant acidity meets flavors of lemon curd, nectarine, and crème brûlée with a mineral finish.", pairings: ["Mahi and Meyer Lemon Sandwich", "Smoked Salmon Plate", "Crab Cake Benny", "Orchard Chicken Salad Croissant"], tags: ["Rich", "Elegant", "Full-Bodied", "Oaked", "Mineral", "Balanced"], scales: { body: 4, acidity: 4, fruit: 4 }, hook: "A sommelier-favorite producer, known for balancing Californian richness with European-style structure and acidity." },
    { id: 15, name: "Domaine Fèvre Premier Cru White Burgundy", type: "White", grape: "Chardonnay", availability: "By bottle only", region: "Chablis, Burgundy, France", taste: "Medium-bodied, bone-dry with razor-sharp acidity. Intense flavors of lemon, oyster shell, and flint. No oak presence.", pairings: ["Chicken and Artichoke Soup", "Modern Caesar with Salmon", "French Style Omelet", "Crab Cake Benny"], tags: ["Crisp", "Dry", "Mineral", "Elegant", "Zesty", "Unoaked", "Classic"], scales: { body: 3, acidity: 5, fruit: 1 }, hook: "Chablis is Chardonnay in its purest form—all about the chalky soil, not oak barrels. This is a Premier Cru, a top-tier vineyard site." },
    { id: 16, name: "Lucy by Pisoni Rosé", type: "Rosé", grape: "Pinot Noir", region: "Santa Lucia Highlands, California", taste: "Dry, crisp, and refreshing. Light-bodied with notes of wild strawberry, cherry, and watermelon.", pairings: ["Smoked Salmon Plate", "Wine Country Sangria Salad", "Mahi and Meyer Lemon Sandwich", "Heirloom Tomato Burrata"], tags: ["Light", "Crisp", "Dry", "Fruity", "Refreshing"], scales: { body: 2, acidity: 4, fruit: 4 }, hook: "A portion of proceeds from every bottle of Lucy Rosé is donated to support breast cancer research." },
    { id: 17, name: "La Croix Peyrassol Rosé", type: "Rosé", grape: "Cinsault", region: "Côtes de Provence, France", grapes: "Cinsault, Grenache, Syrah", taste: "Pale, bone-dry, and elegant. Light-bodied with delicate red berries, white peach, and a saline, stony minerality.", pairings: ["Coastal Chickpea and Salmon", "Mahi and Meyer Lemon Sandwich", "Wine Country Sangria Salad", "Smoked Salmon Plate"], tags: ["Light", "Crisp", "Dry", "Elegant", "Mineral", "Classic"], scales: { body: 2, acidity: 4, fruit: 2 }, hook: "The absolute benchmark for Provence Rosé: light, elegant, and mineral-driven. From an estate with roots going back to the 13th century." },
    { id: 18, name: "La Grangette Côtes du Rhône", type: "Red", grape: "Grenache", region: "Rhône Valley, France", grapes: "Grenache, Syrah, Mourvèdre", taste: "Medium-bodied with soft tannins. Ripe red fruits (cherry, raspberry) with earthy notes of garrigue (wild herbs) and white pepper.", pairings: ["French Style Omelet", "Sun Kissed Pancakes", "Green Goddess", "Spicy Calabrese Flatbread"], tags: ["Earthy", "Spicy", "Medium-Bodied", "Fruity", "Herbal"], scales: { body: 3, acidity: 3, fruit: 3, tannins: 2 }, hook: "A classic 'bistro red' from Southern France that is versatile and exceptionally food-friendly." },
    { id: 19, name: "Gundlach Bundschu Cabernet Blend", type: "Red", grape: "Cabernet Sauvignon", region: "Sonoma Valley, California", grapes: "Cabernet Sauvignon, Merlot", taste: "Full-bodied with structured tannins. Dark fruit like plum and blackberry, with Merlot adding softness. Notes of oak, cocoa, and spice.", pairings: ["Crab Cake Benny", "Smoked Salmon Plate", "Shakshuka"], tags: ["Bold", "Rich", "Full-Bodied", "Oaked", "Structured"], scales: { body: 4, acidity: 3, fruit: 4, tannins: 4 }, hook: "From the oldest family-owned winery in California, established in 1858." },
    { id: 20, name: "Handley Pinot Noir", type: "Red", grape: "Pinot Noir", region: "Anderson Valley, California", taste: "Light to medium-bodied with a silky texture. Bright acidity lifts flavors of cherry, cranberry, and rose petals with an earthy 'forest floor' finish.", pairings: ["Modern Caesar with Salmon", "Green Goddess", "Coastal Chickpea and Salmon"], tags: ["Light", "Earthy", "Elegant", "Fruity", "Silky"], scales: { body: 2, acidity: 4, fruit: 4, tannins: 2 }, hook: "Anderson Valley is a cool, coastal region known for producing elegant, restrained Pinot Noir, closer to a French style." },
    { id: 21, name: "Alexana Pinot Noir (Dundee Hills)", type: "Red", grape: "Pinot Noir", availability: "By bottle only", region: "Willamette Valley, Oregon", taste: "Medium-bodied with vibrant acidity and refined structure. Ripe cherry and raspberry notes mix with earthy tones of dried herbs and a hint of cola.", pairings: ["Coastal Chickpea and Salmon", "Green Goddess", "Heirloom Tomato Burrata"], tags: ["Earthy", "Elegant", "Fruity", "Structured", "Medium-Bodied"], scales: { body: 3, acidity: 4, fruit: 4, tannins: 3 }, hook: "The Dundee Hills are iconic in Oregon, producing Pinot Noir with a signature combination of rich fruit and volcanic soil minerality." },
    { id: 22, name: "Flanagan Cabernet Sauvignon", type: "Red", grape: "Cabernet Sauvignon", region: "Sonoma, California", taste: "Full-bodied and intense with firm, fine-grained tannins. Concentrated flavors of blackberry and cassis with notes of espresso and dark chocolate.", pairings: ["Breakfast Burrito", "Shakshuka"], tags: ["Bold", "Rich", "Full-Bodied", "Oaked", "Structured", "Intense"], scales: { body: 5, acidity: 3, fruit: 5, tannins: 5 }, hook: "A powerful, ageworthy Cabernet that showcases the best of Sonoma's warmer vineyard sites." },
    { id: 23, name: "RouteStock Cabernet Sauvignon (Route 29)", type: "Red", grape: "Cabernet Sauvignon", region: "Napa Valley, California", taste: "Full-bodied, rich, and smooth. Polished tannins with ripe blackberry and black cherry fruit, complemented by vanilla and baking spices from oak.", pairings: ["Shakshuka", "Spicy Calabrese Flatbread", "Breakfast Burrito"], tags: ["Bold", "Rich", "Full-Bodied", "Oaked", "Smooth"], scales: { body: 4, acidity: 3, fruit: 5, tannins: 4 }, hook: "A quintessential Napa Valley Cabernet, designed to be approachable and delicious upon release." },
    { id: 24, name: "Hall Cabernet Sauvignon", type: "Red", grape: "Cabernet Sauvignon", region: "Napa Valley, California", grapes: "95% Cabernet Sauvignon, 5% Merlot", taste: "Powerful and opulent. Full-bodied with bold, velvety tannins. Lush cassis, blueberry, and licorice flavors with a long finish.", pairings: ["Breakfast Burrito", "Ham and Cheese Croissant", "Green Goddess"], tags: ["Bold", "Rich", "Full-Bodied", "Oaked", "Structured", "Intense"], scales: { body: 5, acidity: 3, fruit: 5, tannins: 5 }, hook: "A modern Napa icon, known for its opulent style and for receiving multiple 100-point scores from critics." },
    { id: 25, name: "Frank Family Cabernet Sauvignon", type: "Red", grape: "Cabernet Sauvignon", availability: "By bottle only", region: "Napa Valley, California", taste: "Rich and velvety with plush texture. Flavors of blackberry and plum are balanced with vanilla, espresso, and caramel from new French oak.", pairings: ["Ham and Cheese Croissant", "Coastal Chickpea and Salmon", "Shakshuka"], tags: ["Bold", "Rich", "Full-Bodied", "Oaked", "Smooth", "Structured"], scales: { body: 5, acidity: 3, fruit: 5, tannins: 4 }, hook: "Located in the historic Larkmead winery, Frank Family is one of Napa's most popular and beloved producers." },
    { id: 26, name: "Château Anthonic Moulis-en-Médoc", type: "Red", grape: "Merlot", region: "Bordeaux, France", grapes: "Merlot, Cabernet Sauvignon", taste: "Medium-bodied with an earthy, savory structure and firm tannins. Flavors of blackcurrant and plum mix with notes of tobacco, leather, and cedar.", pairings: ["Shakshuka", "Breakfast Burrito", "Spicy Calabrese Flatbread"], tags: ["Earthy", "Structured", "Classic", "Medium-Bodied", "Savory"], scales: { body: 4, acidity: 4, fruit: 2, tannins: 4 }, hook: "A classic 'Left Bank' Bordeaux, which is Merlot-dominant for softness, but maintains a savory, food-friendly structure." },
    { id: 27, name: "Shafer TD-9 (Bordeaux Blend)", type: "Red", grape: "Merlot", availability: "By bottle only", region: "Napa Valley, California", grapes: "Merlot, Cabernet Sauvignon, Malbec", taste: "Full-bodied, smooth, and fruit-forward. Silky tannins with lush flavors of ripe plum, blackberry, blueberry, and mocha.", pairings: ["Shakshuka", "Spicy Calabrese Flatbread", "Breakfast Burrito"], tags: ["Bold", "Rich", "Full-Bodied", "Smooth", "Fruity"], scales: { body: 4, acidity: 3, fruit: 5, tannins: 3 }, hook: "Named after a tractor John Shafer used when developing his vineyards. A tribute to the hard work of farming." },
    { id: 28, name: "Gaja Ca’Marcanda Promis Toscana IGT", type: "Red", grape: "Merlot", availability: "By bottle only", region: "Tuscany, Italy", grapes: "Merlot, Syrah, Sangiovese", taste: "Medium to full-bodied with polished tannins. A juicy, modern Italian style with notes of black cherry, blackberry, and licorice.", pairings: ["Breakfast Burrito", "Smashed Avocado BLT", "Ham and Cheese Croissant", "Crab Cake Benny"], tags: ["Medium-Bodied", "Smooth", "Fruity", "Earthy", "Spicy", "Italian"], scales: { body: 4, acidity: 4, fruit: 4, tannins: 3 }, hook: "From Angelo Gaja, a legendary producer who revolutionized Italian wine. This 'Super Tuscan' blends French grapes with Italian soul." }
];
const foodMenu = ["Breakfast Burrito", "Chicken and Artichoke Soup", "Coastal Chickpea and Salmon", "Crab Cake Benny", "French Style Omelet", "Green Goddess", "Ham and Cheese Croissant", "Heirloom Tomato Burrata", "Mahi and Meyer Lemon Sandwich", "Modern Caesar Salad", "Modern Caesar with Salmon", "Orchard Chicken Salad Croissant", "Shakshuka", "Smashed Avocado BLT", "Smoked Salmon Plate", "Spicy Calabrese Flatbread", "Sun Kissed Pancakes", "Vanilla Yogurt and Granola Bowl", "Watermelon Seasonal Fruit bowl", "Wine Country Sangria Salad"];
const allTags = [...new Set(wineData.flatMap(w => w.tags))].sort();

// ===================================================================================
// ===== PART 2: APPLICATION LOGIC ===================================================
// ===================================================================================
document.addEventListener('DOMContentLoaded', () => {

    // --- Core Navigation ---
    function setupNav(navSelector, contentSelector, callback) {
        const navBtns = document.querySelectorAll(navSelector);
        const contents = document.querySelectorAll(contentSelector);
        navBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                navBtns.forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                contents.forEach(content => {
                    content.classList.remove('active');
                    if (content.id === btn.dataset.target) {
                        content.classList.add('active');
                    }
                });
                if (callback) callback(btn.dataset.target);
            });
        });
    }

    // --- Study Mode: Flashcards ---
    function renderFlashcards() {
        const container = document.getElementById('flashcard-container');
        if (!container) return;
        container.innerHTML = wineData.map(wine => `
            <div class="wine-card">
                <h4>${wine.name}</h4>
                <button class="details-toggle-btn" data-id="${wine.id}">Show Details</button>
                <div class="flashcard-details" id="details-${wine.id}">
                    <p><strong>Region:</strong> ${wine.region}</p>
                    <p><strong>Grapes:</strong> ${wine.grapes}</p>
                    <p><strong>Taste Profile:</strong> ${wine.taste}</p>
                    ${wine.hook ? `<p class="hook-note">${wine.hook}</p>` : ''}
                </div>
            </div>
        `).join('');

        container.addEventListener('click', (e) => {
            if (e.target.classList.contains('details-toggle-btn')) {
                const id = e.target.dataset.id;
                const details = document.getElementById(`details-${id}`);
                details.classList.toggle('visible');
                e.target.textContent = details.classList.contains('visible') ? 'Hide Details' : 'Show Details';
            }
        });
    }

    // --- Study Mode: Smart Quiz ---
    function generateQuiz() {
        const quizContainer = document.getElementById('quiz-container');
        const resultsContainer = document.getElementById('quiz-results');
        if (!quizContainer) return;

        quizContainer.innerHTML = '';
        resultsContainer.innerHTML = '';
        resultsContainer.className = 'quiz-results';
        let correctCount = 0;

        const questionTypes = [1, 2, 3, 1, 2].sort(() => 0.5 - Math.random());
        const questions = questionTypes.map(type => {
            let wine = wineData[Math.floor(Math.random() * wineData.length)];
            if (type === 1) { // Pairing
                let pairing = wine.pairings[Math.floor(Math.random() * wine.pairings.length)];
                return { q: `A guest orders the <strong>${pairing}</strong>. Which wine is a great recommendation?`, a: wine.name, o: getOptions(wine.name) };
            }
            if (type === 2) { // Comparative
                let comp = ['most', 'least'][Math.floor(Math.random()*2)];
                let scale = ['acidity', 'body', 'fruit', 'tannins'][Math.floor(Math.random()*4)];
                let sorted = [...wineData].filter(w => w.scales[scale]).sort((a,b) => comp === 'most' ? b.scales[scale] - a.scales[scale] : a.scales[scale] - b.scales[scale]);
                let correctWine = sorted.length ? sorted[0] : wineData[0];
                return { q: `Which of these wines is the <strong>${comp} ${scale}</strong>?`, a: correctWine.name, o: getOptions(correctWine.name) };
            }
            // type 3: Guess the wine
            return { q: `I'm looking for a wine from <strong>${wine.region}</strong> with notes of <strong>${wine.tags.slice(0,2).join(', ')}</strong>. What am I?`, a: wine.name, o: getOptions(wine.name) };
        });

        quizContainer.innerHTML = questions.map((q, i) => `
            <div class="quiz-question" id="q-${i}">
                <p>${i + 1}. ${q.q}</p>
                <div class="quiz-options">${q.o.map(opt => `<label data-answer="${q.a}"><input type="radio" name="q${i}" value="${opt}"> ${opt}</label>`).join('')}</div>
            </div>`).join('');

        quizContainer.addEventListener('change', (e) => {
            if (e.target.type === 'radio') {
                const questionDiv = e.target.closest('.quiz-options');
                const correctAnswer = questionDiv.querySelector('label').dataset.answer;
                const chosenAnswer = e.target.value;
                
                // Disable all inputs for this question
                questionDiv.querySelectorAll('input').forEach(input => input.disabled = true);
                
                if (chosenAnswer === correctAnswer) {
                    correctCount++;
                    e.target.parentElement.classList.add('correct');
                } else {
                    e.target.parentElement.classList.add('incorrect');
                    questionDiv.querySelector(`input[value="${correctAnswer}"]`).parentElement.classList.add('correct');
                }
                
                // Check if quiz is finished
                const totalAnswered = quizContainer.querySelectorAll('input[type="radio"]:disabled').length / 4;
                if (totalAnswered === 5) {
                    resultsContainer.innerHTML = `Quiz Complete! You scored ${correctCount} out of 5.`;
                    resultsContainer.classList.add(correctCount >= 3 ? 'success' : 'failure');
                }
            }
        });
    }
    function getOptions(correctAnswer) {
        const allNames = wineData.map(w => w.name);
        const options = new Set([correctAnswer]);
        while(options.size < 4) {
            options.add(allNames[Math.floor(Math.random() * allNames.length)]);
        }
        return [...options].sort(() => 0.5 - Math.random());
    }

    // --- Study Mode: Visual Explorer ---
    let selectedVisualWineId = null;
    function renderVisualExplorer() {
        const wineListContainer = document.getElementById('visual-wine-list');
        wineListContainer.innerHTML = wineData.map(wine => `<span class="wine-plot-item" data-id="${wine.id}">${wine.name}</span>`).join('');
        wineListContainer.addEventListener('click', e => {
            if (e.target.classList.contains('wine-plot-item')) {
                selectedVisualWineId = parseInt(e.target.dataset.id);
                wineListContainer.querySelectorAll('.wine-plot-item').forEach(item => item.classList.remove('selected'));
                e.target.classList.add('selected');
                renderSpectrumCharts();
            }
        });

        const groupBtnContainer = document.getElementById('group-buttons-container');
        const mainGrapes = [...new Set(wineData.map(w => w.grape))];
        groupBtnContainer.innerHTML = mainGrapes.map(g => `<button class="group-btn" data-grape="${g}">${g}</button>`).join('');
        groupBtnContainer.addEventListener('click', e => {
            if(e.target.classList.contains('group-btn')) {
                groupBtnContainer.querySelectorAll('.group-btn').forEach(b => b.classList.remove('active'));
                e.target.classList.add('active');
                renderComparativeGroupings(e.target.dataset.grape);
            }
        });
    }
    function renderSpectrumCharts() {
        const container = document.getElementById('spectrum-charts-container');
        const wine = wineData.find(w => w.id === selectedVisualWineId);
        const charts = [
            { title: 'Body', legend: ['Light', 'Full'], key: 'body' },
            { title: 'Acidity', legend: ['Mellow', 'Sharp'], key: 'acidity' },
            { title: 'Fruit vs. Earth', legend: ['Earthy/Mineral', 'Fruit-Forward'], key: 'fruit' },
            { title: 'Tannins (Reds)', legend: ['Soft', 'Firm'], key: 'tannins' },
        ];
        if (!wine) { container.innerHTML = "<p>Select a wine to see its spectrum analysis.</p>"; return; }
        container.innerHTML = charts.map(chart => {
            if (!wine.scales[chart.key]) return '';
            const width = (wine.scales[chart.key] / 5) * 100;
            return `
                <div class="spectrum-chart">
                    <h4>${chart.title}</h4>
                    <div class="spectrum-bar-container"><div class="spectrum-bar" style="width: ${width}%"></div></div>
                    <div class="spectrum-legend"><span>${chart.legend[0]}</span><span>${chart.legend[1]}</span></div>
                </div>`;
        }).join('');
    }
    function renderComparativeGroupings(grape) {
        const container = document.getElementById('comparison-container');
        const wines = wineData.filter(w => w.grape === grape);
        container.innerHTML = wines.map(wine => `
            <div class="comparison-card">
                 <h4>${wine.name} (${wine.region})</h4>
                 <p>${wine.taste}</p>
            </div>
        `).join('') || "<p>Select a grape to see comparisons.</p>";
    }

    // --- Service Mode: Recommender ---
    function initializeRecommender() {
        const container = document.getElementById('filter-container');
        container.innerHTML = `<div class="filter-tags">${allTags.map(tag => `
            <input type="checkbox" id="tag-${tag}" value="${tag}" class="filter-checkbox">
            <label for="tag-${tag}">${tag}</label>
        `).join('')}</div>`;
        container.addEventListener('change', updateRecommenderResults);
    }
    function updateRecommenderResults() {
        const container = document.getElementById('filter-results');
        const selectedTags = [...document.querySelectorAll('#filter-container input:checked')].map(box => box.value);

        if (selectedTags.length === 0) {
            container.innerHTML = '<p>Select tags to see recommendations.</p>';
            return;
        }

        const results = wineData.map(wine => {
            const matches = selectedTags.filter(tag => wine.tags.includes(tag));
            const mismatches = selectedTags.filter(tag => !wine.tags.includes(tag));
            return { ...wine, score: matches.length, matches, mismatches };
        }).filter(wine => wine.score > 0).sort((a,b) => b.score - a.score);

        if (results.length === 0) {
            container.innerHTML = '<p>No wines match that criteria.</p>';
            return;
        }

        container.innerHTML = results.map(wine => `
            <div class="wine-card match-card">
                <h4>${wine.name}</h4>
                <ul>
                    ${wine.matches.map(tag => `<li class="match">✅ Matches: ${tag}</li>`).join('')}
                    ${wine.mismatches.map(tag => `<li class="mismatch">❌ Doesn't Match: ${tag}</li>`).join('')}
                </ul>
            </div>`).join('');
    }
    
    // --- Service Mode: Food Pairing ---
    function initializeFoodPairing() {
        const container = document.getElementById('food-menu-container');
        const resultsContainer = document.getElementById('pairing-results');
        container.innerHTML = foodMenu.map(item => `<div class="food-card" data-food="${item}">${item}</div>`).join('');
        container.addEventListener('click', e => {
            if (e.target.classList.contains('food-card')) {
                container.querySelectorAll('.food-card').forEach(c => c.classList.remove('selected'));
                e.target.classList.add('selected');
                const food = e.target.dataset.food;
                let pairings = wineData.filter(w => w.pairings.includes(food));
                let specialNote = '';

                if (food === 'Modern Caesar Salad') {
                    const salmonWines = wineData.filter(w => w.pairings.includes('Modern Caesar with Salmon'));
                    pairings = [...new Set([...pairings, ...salmonWines])];
                    specialNote = `<div class="special-note"><strong>Suggestion:</strong> For the Caesar with Salmon, the <strong>${salmonWines.map(w=>w.name).join(' or ')}</strong> are particularly excellent choices.</div>`;
                }

                if (pairings.length === 0) {
                    resultsContainer.innerHTML = `<h3>No recommended pairings for ${food}.</h3>`;
                    return;
                }
                resultsContainer.innerHTML = `
                    <h3>Pairings for ${food}</h3>
                    ${specialNote}
                    ${pairings.map(wine => `
                         <div class="wine-card">
                            <h4>${wine.name}</h4>
                            <div class="pairing-reason"><strong>Why it works:</strong> ${wine.taste}</div>
                         </div>
                    `).join('')}`;
            }
        });
    }

    // --- Initial Load & Nav Setup ---
    setupNav('.main-nav-btn', '.content-section');
    setupNav('#study-section .sub-nav-btn', '#study-section .tool-content');
    setupNav('#visuals-tool .sub-nav-btn', '#visuals-tool .tool-content');
    setupNav('#service-section .sub-nav-btn', '#service-section .tool-content');

    renderFlashcards();
    generateQuiz();
    document.getElementById('new-quiz-btn').addEventListener('click', generateQuiz);
    renderVisualExplorer();
    initializeRecommender();
    initializeFoodPairing();
});
</script>

</body>
</html>
